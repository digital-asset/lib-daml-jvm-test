-- Copyright (c) 2020, Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

module Main where

import Daml.Script

import PingPong

main : Script ()
main = do
  alice <- allocate "Alice"
  bob <- allocate "Bob"
  ping1
    <- submit alice do
        createCmd Ping with
          sender = alice
          receiver = bob
          count = 2
  pong1
    <- submit bob do
        exerciseCmd ping1 RespondPong
  ping2
    <- submit alice do
        exerciseCmd pong1 RespondPing
  pure ()

init : Script ()
init = do
    alice <- allocate "Alice"
    bob   <- allocate "Bob"

    ping1 <- submit alice $ createCmd Ping with sender = alice; receiver = bob; count = 2
    pong1 <- submit bob   $ exerciseCmd ping1 RespondPong
    ping2 <- submit alice $ exerciseCmd pong1 RespondPing
    pure ()

allocate : Text -> Script Party
allocate name = allocatePartyWithHint name (PartyIdHint name)
